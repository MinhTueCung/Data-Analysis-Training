clear all;close all;%time constantsa = 0.012; % in days-1b = 0.27;x = 0.0000015;y = 0.002;n = 0.02;r = 0.01;u = 0.015;% we have to multiply %with dt to obtain the probality% how to chose the dt ?% 1/a : time in days% dt is small compare to the shortest period in days% %dt = min([a,b,x,y,n,r,u].^(-1))/100;dt = min([a,b,x,y,n,r,u].^(-1))/100%1/b% build the markow matrix M (canonical form) na = 2; % nb absorbing states - here S + Hnt = 4; % nb transition states - here F,R,N,Unstep = 10000;%    % S   H|    F          R    N  U %M=dt*[1/dt      0          a            %S%      0  1/dt   0          x            %H%      0  0    1/dt-(r+n+u) 0            %F%      0  0      r          1/dt-(a+x)   %R%      0  0      n          0            %N%      0  0      u          0            %U            %   S   H    F          R          N          UM=[1/dt 0    0          a          0          b ; ...    0   1/dt 0          x          0          y ; ...    0   0    1/dt-r-n-u 0          n          0 ; ...    0   0    r          1/dt-a-x   r          0 ; ...    0   0    n          0          1/dt-n-r-u 0 ; ...    0   0    u          0          u          1/dt-b-y]*dt; ...sum(M)  % check ! sum(M) should be 1 for each column.% Extract the matrix R, Q from the M matrix:% R: Transition from non-absorbing --> absorbingR = M(1:na,na+1:na+nt);  % F,R,N,U  --> S,H (2 absorbing states!)Q = M(na+1:na+nt,na+1:na+nt); % F,R,N,U (non-absorbing to each other!)%Build the fundamental matrix:I = eye(size(Q));F = inv(I-Q);% The time matrixT = F*dt% in days.% Absorption matrix:A = R*Fdisp('sum of columns of A') % it should be 1disp(sum(A))% %A =%%     F            R              N          U  %   9.9554e-01   9.9988e-01   9.9554e-01   9.9265e-01  S%   4.4618e-03   1.2498e-04   4.4618e-03   7.3529e-03  H% 99.5% the nitrates go to the SEA% only 0.05% go to the HUMAN % %T = %in days%     F            R              N          U  %   27.69231    0.00000   12.30769   -0.00000   F%   33.32917   83.32292   33.32917   -0.00000   R%   12.30769    0.00000   27.69231   -0.00000   N%    2.20588    0.00000    2.20588    3.67647   U%%the nitrates stays on average 27 days in FIELD and in Neibourging fields% 83 days in RIVER% and only 3.6 days in Undergound % Time evolution of the markov process:N = zeros(na+nt,nstep);N(3,1) = 1; % first column is for initial population, %initally the nitrates are localized in the FIELD (row 3)%N(:,1)=%%   0%   0%   1%   0%   0%   0for j=2:nstepN(:,j)= M*N(:,j-1);end time = (1 : nstep)*dt; %in days%plot(time,N')plot(time,N(1,:),'b') %state SEA over the time (blue line)hold on;plot(time,N(2,:),'r') %state HUMAN over the time ( red line)plot(time,N(3,:),'k') %state FIELD over the time ( black line)%after 1 year the proportion of nitrate on the FIELD is zero.plot(time,N(4,:),'m') %state  RIVER over the time ( magneta line)% proportion nitrate in RIVER > 0.1 from 20-150 days (4 months)plot(time,N(5,:),'g') %state  Neibourging field over the time ( green line)plot(time,N(6,:),'c') %state  Undergound over the time ( cian line)